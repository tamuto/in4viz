# ER図可視化ライブラリ開発記録

## プロジェクト概要
Python製のER図専用可視化ライブラリ。ステンシル（形状テンプレート）アーキテクチャを採用し、SVGファイルを出力する。

## 主要機能
- テーブルの論理名・物理名対応
- カラムの論理名・物理名対応  
- NULLABLE・FK制約の表示
- PKカラムと通常カラムの境界線による分離
- コンテンツに応じた動的幅計算
- 自動レイアウト・配置

## ファイル構成
```
planning/
├── planning/
│   ├── __init__.py          # パッケージエントリーポイント
│   ├── stencil.py          # ステンシル（形状テンプレート）
│   └── diagram.py          # ER図管理・レイアウト
├── example.py              # サンプル実装
└── er_diagram_example.svg  # 出力例
```

## 実装詳細

### ステンシルアーキテクチャ
- `Stencil`基底クラス: 抽象形状テンプレート
- `TableStencil`クラス: ER図テーブル専用ステンシル
- データとレンダリングロジックの分離

### 文字幅計算
**重要**: 実際のフォントメトリクスを使用せず、簡易近似計算を採用
- 日本語文字（論理名）: 文字数 × 11px + padding
- 英語文字（物理名・型・制約）: 文字数 × 6px + padding
- フォント: Arial
- 最小幅設定: 論理40px、物理30px、型45px、制約60px

### テーブル表示形式
- **テーブル名**: "論理名 (物理名)" 形式、12px太字
- **カラム論理名**: 10px標準、黒色
- **カラム物理名**: 10px標準、黒色  
- **データ型**: 9px標準、黒色
- **制約**: 9px標準、黒色

### PKカラムの扱い
- **境界線のみで区別**: PKカラム下部に境界線を描画
- **PK表示除去**: 制約欄から"PK"文字列を削除
- **装飾なし**: 色付けやボールド体による装飾を禁止
- **PKのみテーブル**: 通常カラム欄に空行を1行追加

### 制約表示
- NOT NULL: "NOT NULL"
- 外部キー: "FK"  
- 複数制約: カンマ区切り（例: "NOT NULL, FK"）
- **PK制約は非表示**（境界線で判別）

## 開発時の注意事項

### 厳格な要求仕様遵守
1. **要求以上のことはしない**: 明示的に求められていない機能や装飾は追加禁止
2. **勝手な装飾禁止**: 色付け、太字、影響などの視覚的装飾は指示がない限り実装しない
3. **計算の正確性**: 文字幅計算などは適切に検証し、はみ出しや重なりを防ぐ

### 実装原則
- 既存ファイルの編集を優先、新規ファイル作成は最小限
- ドキュメントファイル(.md)の自発的作成は禁止
- 機能追加時は既存のコード規約・パターンに従う

### 文字幅計算の考慮事項
- 日本語とASCII文字の幅の違いを適切に処理
- 実際の表示での重なりを防ぐため十分なマージンを確保
- フォントサイズと計算式の整合性を維持

## 現在の出力例
- ユーザーテーブル: 299px幅、4カラム
- 投稿テーブル: 322px幅、5カラム
- カテゴリテーブル: 294px幅、3カラム
- 投稿カテゴリテーブル: 279px幅、2PKカラム+空行1行

## 今後の拡張性
- 関係線の描画機能
- より複雑なレイアウトアルゴリズム
- カスタムスタイル設定
- 他の図形タイプのステンシル追加